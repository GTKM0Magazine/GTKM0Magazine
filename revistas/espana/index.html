<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edici√≥n Espa√±a | Global Tour KM0 Magazine</title>

<style>
  :root{
    --bg:#0f0f10;
    --panel: rgba(16,16,18,.80);
    --border: rgba(255,255,255,.10);
    --text: rgba(255,255,255,.92);
    --muted: rgba(255,255,255,.65);
    --accent:#e10600;
  }

  *{ box-sizing:border-box; }

  body{
    background:var(--bg);
    margin:0;
    overflow:hidden;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
  }

  /* TOPBAR */
  .topbar{
    position:fixed;
    top:0; left:0; right:0;
    height:64px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 16px;
    background:var(--panel);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom:1px solid var(--border);
    z-index:9999;
  }

  .topbar .center{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    text-align:center;
    line-height:1.05;
    pointer-events:none;
  }

  .brand{
    font-size:15px;
    font-weight:700;
    letter-spacing:.2px;
    color:var(--text);
    white-space:nowrap;
  }

  .edition{
    margin-top:3px;
    font-size:12.5px;
    color:var(--muted);
    letter-spacing:.2px;
    white-space:nowrap;
  }

  .group{
    display:flex;
    align-items:center;
    gap:10px;
  }

  .btn{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 12px;
    border-radius:999px;
    border:1px solid var(--border);
    background: rgba(255,255,255,.06);
    color:var(--text);
    text-decoration:none;
    font-size:13px;
    font-weight:700;
    letter-spacing:.15px;
    user-select:none;
    cursor:pointer;
  }
  .btn:hover{ background: rgba(255,255,255,.10); }

  .btn.red{
    border-color: rgba(225,6,0,.55);
    background: rgba(225,6,0,.18);
  }
  .btn.red:hover{ background: rgba(225,6,0,.28); }

  .btn svg{ display:block; }

  .btn .label{
    display:inline;
  }

  /* VIEWPORT */
  .magazine-viewport{
    width:100vw;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    position:relative;
    padding-top:74px; /* espacio para la topbar */
  }

  /* FLIPBOOK */
  #flipbook{
    width:1000px;
    height:707px;
    opacity:0;
    pointer-events:none;
    transition:opacity .25s ease-in;
  }

  .page{
    width:500px;
    height:707px;
    background:#fff center/contain no-repeat;
    box-shadow:0 0 22px rgba(0,0,0,.55);
  }

  /* Loader */
  #loading{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    color:rgba(255,255,255,.7);
    font-size:14px;
    pointer-events:none;
  }

  /* Nav buttons */
  .nav{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    width:52px;
    height:52px;
    border-radius:50%;
    border:1px solid var(--border);
    background: rgba(0,0,0,.30);
    color:#fff;
    cursor:pointer;
    z-index:50;
    display:flex;
    align-items:center;
    justify-content:center;
    user-select:none;
  }
  .nav:hover{ background: rgba(0,0,0,.55); }
  .nav.prev{ left:14px; }
  .nav.next{ right:14px; }
  .nav svg{ opacity:.9; }

  /* Toast */
  .toast{
    position:fixed;
    left:50%;
    transform:translateX(-50%);
    bottom:18px;
    background:rgba(0,0,0,.65);
    border:1px solid var(--border);
    color:var(--text);
    padding:10px 12px;
    border-radius:999px;
    font-size:12px;
    opacity:0;
    pointer-events:none;
    transition: opacity .2s ease;
    z-index:9999;
  }
  .toast.show{ opacity:1; }

  /* Responsive */
  @media (max-width: 900px){
    .topbar{ height:56px; padding:0 12px; }
    .magazine-viewport{ padding-top:64px; }

    .brand{ font-size:14px; }
    .edition{ font-size:12px; }

    .btn{ padding:9px 10px; gap:8px; }
    .btn .label{ display:none; } /* solo iconos */

    #flipbook{
      width:90vw;
      height:calc(90vw * 1.414);
    }
  }

</style>
</head>

<body>

<header class="topbar">
  <div class="group">
    <a class="btn" href="/GTKM0Magazine/" aria-label="Volver al archivo">
      <!-- Icono volver -->
      <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
        <path d="M15 18l-6-6 6-6" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="label">Otras ediciones</span>
    </a>
  </div>

  <div class="center">
    <div class="brand">Global Tour Km0 Magazine</div>
    <div class="edition">Edici√≥n n¬∫.7 ¬∑ Espa√±a</div>
  </div>

  <div class="group">
    <a class="btn red" href="revista_espana.pdf" download aria-label="Descargar PDF">
      <!-- Icono descarga -->
      <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
        <path d="M12 3v11" stroke="white" stroke-width="2" fill="none" stroke-linecap="round"/>
        <path d="M7 11l5 5 5-5" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M5 21h14" stroke="white" stroke-width="2" fill="none" stroke-linecap="round"/>
      </svg>
      <span class="label">Descargar</span>
    </a>

    <button class="btn" id="btnShare" type="button" aria-label="Compartir enlace">
      <!-- Icono compartir/copy -->
      <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
        <rect x="9" y="9" width="12" height="12" rx="2" ry="2" stroke="white" stroke-width="2" fill="none"/>
        <rect x="3" y="3" width="12" height="12" rx="2" ry="2" stroke="white" stroke-width="2" fill="none" opacity=".8"/>
      </svg>
      <span class="label">Compartir</span>
    </button>
  </div>
</header>

<div class="magazine-viewport">
  <audio id="audioFlip" preload="auto" src="/GTKM0Magazine/assets/page-flip.mp3"></audio>

  <div id="flipbook"></div>
  <div id="loading">Cargando revista‚Ä¶</div>

  <button class="nav prev" aria-label="P√°gina anterior" type="button">
    <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
      <path d="M15 18l-6-6 6-6" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>

  <button class="nav next" aria-label="P√°gina siguiente" type="button">
    <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
      <path d="M9 6l6 6-6 6" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>
</div>

<div class="toast" id="toast">Enlace copiado ‚ú®</div>

<!-- Librer√≠as -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/GTKM0Magazine/assets/turn.min.js"></script>

<script>
  // ====== CONFIG (cambia esto para cada pa√≠s) ======
  const CFG = {
    pais: "Espa√±a",
    slug: "espana",
    totalPaginas: 30,
    pdf: "revista_espana.pdf"
  };
  // =================================================

  function preload(urls){
    return Promise.all(urls.map(u => new Promise(res=>{
      const img = new Image();
      img.onload = ()=>res(true);
      img.onerror = ()=>res(false);
      img.src = u;
    })));
  }

  function getDims(){
    const esMovil = window.innerWidth < 900;
    const pageW = esMovil ? Math.floor(window.innerWidth * 0.9) : 500;
    const pageH = Math.floor(pageW * 1.414);
    return {
      esMovil,
      pageW,
      pageH,
      width: esMovil ? pageW : pageW * 2,
      height: pageH,
      display: esMovil ? "single" : "double"
    };
  }

  function showToast(msg){
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"), 1400);
  }

  // Rellena textos autom√°ticamente (por si duplicas carpetas)
  document.title = `Revista ${CFG.pais} | GTKM0`;
  document.querySelector(".edition").textContent = `Revista ¬∑ ${CFG.pais}`;
  document.querySelector('a[download]').setAttribute("href", CFG.pdf);

  $(async function(){
    const fb = $("#flipbook");
    const audio = document.getElementById("audioFlip");
    const loading = document.getElementById("loading");

    if(!(jQuery.fn && typeof jQuery.fn.turn === "function")){
      loading.textContent = "turn.js no carg√≥ (revisa /assets/turn.min.js)";
      return;
    }

    const PAGE_BASE = `/GTKM0Magazine/revistas/${CFG.slug}/paginas/`;

    // Crear p√°ginas
    for(let i=1;i<=CFG.totalPaginas;i++){
      const num = String(i).padStart(3,"0");
      fb.append(`<div class="page" style="background-image:url('${PAGE_BASE}${num}.png')"></div>`);
    }

    // Precargar primeras p√°ginas
    const primeras = [1,2,3,4,5,6].filter(n=>n<=CFG.totalPaginas)
      .map(n => PAGE_BASE + String(n).padStart(3,"0") + ".png");

    const ok = await preload(primeras);
    if(ok.every(v=>!v)){
      loading.textContent = "No se cargan las p√°ginas (ruta/nombres).";
      return;
    }

    const d = getDims();
    $(".page").css({ width: d.pageW+"px", height: d.pageH+"px" });
    fb.css({ width: d.width+"px", height: d.height+"px" });

    let readyForSound = false;

    fb.turn({
      width: d.width,
      height: d.height,
      display: d.display,
      autoCenter:true,
      acceleration:true,
      gradients:true,
      elevation:50,
      when:{
        turned:function(event, page){
          // Sonido solo cuando ya est√° interactivo y no en la carga inicial
          if(readyForSound && page > 1 && audio){
            audio.pause();
            audio.currentTime = 0;
            audio.play().catch(()=>{});
          }
          readyForSound = true;
        }
      }
    });

    // Botones nav
    document.querySelector(".nav.prev").addEventListener("click", ()=>fb.turn("previous"));
    document.querySelector(".nav.next").addEventListener("click", ()=>fb.turn("next"));

    // Teclado
    $(document).on("keydown", e=>{
      if(e.key==="ArrowLeft") fb.turn("previous");
      if(e.key==="ArrowRight") fb.turn("next");
    });

    // Click izquierda/derecha
    fb.on("click", ".page", function(e){
      const rect = this.getBoundingClientRect();
      const x = e.clientX - rect.left;
      if(x < rect.width/2) fb.turn("previous");
      else fb.turn("next");
    });

    fb.css({opacity:1, pointerEvents:"auto"});
    loading.style.display="none";
  });

  // Compartir / copiar enlace
  document.getElementById("btnShare").addEventListener("click", async ()=>{
    const url = window.location.href;
    try{
      if(navigator.share){
        await navigator.share({ title: document.title, url });
      }else{
        await navigator.clipboard.writeText(url);
        showToast("Enlace copiado ‚ú®");
      }
    }catch(e){
      try{
        await navigator.clipboard.writeText(url);
        showToast("Enlace copiado ‚ú®");
      }catch(_){
        showToast("No se pudo copiar üòÖ");
      }
    }
  });

  // Recalcular al redimensionar
  let rt;
  window.addEventListener("resize", ()=>{
    clearTimeout(rt);
    rt=setTimeout(()=>location.reload(),300);
  });
</script>

</body>
</html>